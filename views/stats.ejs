<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Encurtador</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
  <link rel='stylesheet' href='/stylesheets/style.css' />
  <script>
    // Obtenha valores dinâmicos do servidor
    const code = '<%= code %>';
    const url = '<%= url %>';
    const hits = '<%= hits %>';
    const updatedAt = '<%= updatedAt %>';
    const domain = '<%= process.env.DOMAIN %>';

    // Concatene o domínio e o código para a URL completa
    const fullUrl = domain + code;

    // Função para contar as visitas
    async function countVisit() {
      try {
        await fetch(`/api/countVisit/${code}`, { method: 'POST' });
      } catch (error) {
        console.error('Erro ao contar visita:', error);
      }
    }

    // Atualize os elementos HTML com os valores dinâmicos e conte as visitas
    window.onload = function () {
      document.getElementById('shortened-url').innerText = fullUrl;
      document.getElementById('original-url').innerText = url;
      document.getElementById('hits-count').innerText = hits; // Corrigido para exibir o número de visitas
      document.getElementById('last-visit').innerText = updatedAt;
      countVisit(); // Conte as visitas ao carregar a página
    };
  </script>
</head>

<body>
  <div class="container">
    <div class="header">
      <img src="/images/web_server.png" alt="Encurtador" class="icon" />
      <h1>Encurtador</h1>
      <p>Estatísticas de acesso</p>
    </div>
    <div class="stats">
      <p>
        <b id="shortened-url"></b>
      </p>
      <p>Redireciona para:<br /><span id="original-url"></span></p>
      <div class="statsRow">
        <div class="statsBox">
          <b id="hits-count"></b>
          <p>Visitas</p>
        </div>
        <div class="statsBox">
          <b id="last-visit"></b>
          <p>Última Visita</p>
        </div>
      </div>
      <a href="/" class="btn btn-primary">Encurtar nova URL</a>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW"
    crossorigin="anonymous"></script>
</body>

</html>
